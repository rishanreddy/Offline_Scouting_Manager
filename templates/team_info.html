{% extends "base.html" %}
{% set current_page = 'analysis' %}
{% block title %}Team {{ team_data.team_number }} Info - Offline Scouting Manager{% endblock %}

{% block content %}
<section class="py-4">
  <div class="container">
    <!-- Header -->
    <div class="card mb-4">
      <div class="card-body d-flex justify-content-between align-items-start">
        <div>
          <h1 class="h3 mb-1">Team {{ team_data.team_number }}</h1>
          <div class="small text-muted-app">Detailed scouting information for this team</div>
        </div>
        <a href="{{ url_for('analyze') }}" class="btn btn-outline-secondary btn-sm">Back to Analysis</a>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card h-100 stats-card stat-card-gradient">
          <div class="card-body">
            <div class="stats-label">Total Matches</div>
            <div class="stats-value">{{ team_data.total_matches }}</div>
          </div>
        </div>
      </div>
      {% for field_name, field_stats in team_data.stats.items() %}
      <div class="col-md-3">
        <div class="card h-100 stats-card hover-lift">
          <div class="card-body">
            <div class="stats-label">Avg {{ field_name.replace('_', ' ').title() }}</div>
            <div class="stats-value">{{ field_stats.average }}</div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if show_trends %}
    <!-- Performance Graphs -->
    <div class="row g-3 mb-4">
      {% for field_config in graph_fields %}
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <div class="small text-muted-app">
                  {{ field_config.label if field_config.label else field_config.field.replace('_', ' ').title() }}
                </div>
                <div class="h5 mb-0">{{ team_data.stats.get(field_config.field, {}).get('average', 0) }}</div>
              </div>
            </div>
            <canvas id="chart-{{ field_config.field }}"></canvas>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if show_radar %}
    <div class="card mb-4">
      <div class="card-body">
        <h2 class="h5">Performance Overview</h2>
        <p class="small text-muted-app mb-3">Radar scores are normalized against the best observed team average (0-100).</p>
        <div class="mx-auto" style="max-width: 520px; max-height: 520px;">
          <canvas id="radar-chart"></canvas>
        </div>
      </div>
    </div>
    {% endif %}
    {% endif %}

    <!-- Data Table -->
    <div class="card">
      <div class="card-body">
        <h2 class="h5">Match Records</h2>
        <div class="table-responsive">
          <table id="teamMatchesTable" class="table table-dark table-striped align-middle" role="table">
            <thead>
              <tr>
                {% if team_matches_display %}
                  {% for key in team_matches_display[0].keys() %}
                  <th scope="col">{{ key.replace('_', ' ').title() }}</th>
                  {% endfor %}
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for match in team_matches_display %}
              <tr>
                {% for value in match.values() %}
                <td>{{ value }}</td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
  window.teamInfoData = {
    teamNumber: {{ team_data.team_number | tojson }},
    showTrends: {{ show_trends | tojson }},
    matches: {{ team_data.matches | tojson }},
    choiceLabelMaps: {{ choice_label_maps | tojson }},
    choiceDisplayEntries: {{ choice_display_entries | tojson }},
    fieldTypes: {{ field_types | tojson }},
    graphFields: {{ graph_fields | tojson }},
    showRadar: {{ show_radar | tojson }},
    radarDataByField: {{ radar_data | tojson }},
    radarDataValues: {{ radar_data.values() | list | tojson }}
  };
</script>
<script src="{{ url_for('static', filename='js/team_info.js') }}"></script>
{% endblock %}
